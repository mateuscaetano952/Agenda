const Login = require('../models/contatoModel')

//Salva sessÃ£o e retorna mensagens de feedback para o usuario(erro ou sucesso)
//rota -> rota de redirecionamento
//listaDeMsg -> array com mensagems de feedback
//temError -> true ou false
const lidaComResposta = (req, res, rota, listaDeMsg, temError ) => {
    if(temError){
        req.flash('errors', listaDeMsg);
    }else{
        req.flash('success', listaDeMsg);
    }

    return req.session.save(() => res.redirect(rota));
}

exports.index = (req, res) =>  {
    res.render('criarContato.ejs', { contato: {}});
};

exports.criarContato = async (req, res) =>  {
 try{
    const contato = new Login(req.body);
    await contato.criarContato();
 
    if(contato.errors.length > 0){
        lidaComResposta(req, res, '/contato/index', contato.errors, true);
        return;
    }

    lidaComResposta(req, res, `/contato/index/${contato.contato._id}`, contato.success, false);
    return;
 }catch(error){
    console.log(error);
    return res.render('error');
 }
   
};

exports.editIndex = async (req, res) => {
    if(!req.params.id)    return;

    const id = req.params.id;

    const contato = await Login.achaContato(req.params.id);
    console.log(contato)
    res.render("criarContato", {contato});
}

exports.editContato = (req, res) => {
    res.send("CÃ­");
}

